(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     39213,       1036]
NotebookOptionsPosition[     37776,       1002]
NotebookOutlinePosition[     38135,       1018]
CellTagsIndexPosition[     38092,       1015]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Sigma Matrix Reconstruction", "Title",
 CellChangeTimes->{{3.738403363134262*^9, 3.738403641431961*^9}, {
  3.7384037645656147`*^9, 
  3.738403781642435*^9}},ExpressionUUID->"8a0ca74d-3ee4-45cb-b80d-\
ab13dc7b6af9"],

Cell[CellGroupData[{

Cell["\<\
Setup the problem of a single wire scanner with multiple optics (actually the \
problem is the same if we have multiple wire scanners we just interpret it \
differently.)\
\>", "Chapter",
 CellChangeTimes->{{3.738403363134262*^9, 3.738403641431961*^9}, {
   3.7384037645656147`*^9, 3.738403792723948*^9}, {3.738497492555859*^9, 
   3.7384974977630672`*^9}, 3.738499981689089*^9, {3.738500015744184*^9, 
   3.738500030042747*^9}, {3.738500718629259*^9, 3.738500741565021*^9}, 
   3.738676951283703*^9},ExpressionUUID->"65fc3e1f-07b4-4f10-885c-\
0d4867cd770d"],

Cell[TextData[{
 "\nWe will use r and \[Sigma] to represent the transfer matrix, and the \
envelope matrix. \nTransport of the envelope is done using \[Sigma](s) = R(0\
\[RightArrow]s).",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Sigma]", "0"], TraditionalForm]],ExpressionUUID->
  "d378cf73-4d7b-4b31-b562-7d8e511476c7"],
 ".Transpose[R(0\[RightArrow]s)], we then want to extract the three values \
relevant to our measurement, ",
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    RowBox[{"(", 
     RowBox[{"\[Sigma]", "(", "s", ")"}], ")"}], 
    RowBox[{"11", ",", "33", ",", "13"}]], TraditionalForm]],ExpressionUUID->
  "970eda71-e13b-41ed-82b9-4c1b4115eae3"],
 ", the coefficients for each element of ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["\[Sigma]", "0"], TraditionalForm]],ExpressionUUID->
  "420e494a-32d8-4500-af6b-04d5f4ccfde1"],
 ". \nWe exploit the symmetry of the \[Sigma] matrix (i.e. ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sigma]", "13"], "=", 
    SubscriptBox["\[Sigma]", "31"]}], TraditionalForm]],ExpressionUUID->
  "35ff2120-891e-41c3-abc1-7afa804e271d"],
 ") etc. \n"
}], "Text",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQnbKsrn32rdeOH6IsekG0kZDMZBBtdzFgBog+4/x7
JYieJXJyLYhe53V8O4h2k+Y7BqLvBhaeBtFXpC0fgujvexLfgehJeqmfQLSN
71yOOUD6RdRlQRD9xH+aOIjec/KzNIhu03uqCKLF7pWpgeiwPdw6IHqCRxCY
tnhSbQiifz7bZgNWv3ebI4j+xHomG0R7e30sBNGvKr6WgGiV6xU75gLpb/9a
DoJond0ZJ0C0ykX5hyB656zuzyB6grgW2zwgbda7RxNEX6tW0AXR6wLDjED0
neWrwLRn6QprEM1nmJkNoldMly8A0R+MQypBtNdllpL5QDoo0b0URAMApevC
qw==
  "],ExpressionUUID->"9ff1ce17-d240-4489-9e41-e8bd16969459"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", 
  RowBox[{
  "r", ",", "\[Sigma]", ",", "orderedSigmaElements", ",", 
   "generalMeasurementMatrix"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"orderedSigmaElements", ",", "generalMeasurementMatrix"}], "}"}],
     "=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"rmat", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"i", ",", "j"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\[Sigma]mat", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"\[Sigma]", "[", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"i", ",", "j"}], "]"}], ",", 
             RowBox[{"Max", "[", 
              RowBox[{"i", ",", "j"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", "4"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", "4"}], "}"}]}], "]"}]}], ",", 
        "\[IndentingNewLine]", "unknowns", ",", "\[IndentingNewLine]", 
        "trans", ",", "coefficients", ",", 
        RowBox[{"dummy", "=", 
         RowBox[{"Array", "[", 
          RowBox[{
           RowBox[{"0", "&"}], ",", 
           RowBox[{"{", 
            RowBox[{"10", ",", "3"}], "}"}]}], "]"}]}]}], 
       "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"trans", "=", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"rmat", ".", "\[Sigma]mat", ".", 
             RowBox[{"Transpose", "[", "rmat", "]"}]}], ")"}], "[", 
           RowBox[{"[", 
            RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "&"}], "/@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "1"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", ",", "3"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "3"}], "}"}]}], "}"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Take", " ", "elements", " ", "xx"}], ",", "yy", ",", 
         RowBox[{"xy", " ", "from", " ", 
          RowBox[{"\[Sigma]", "'"}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"unknowns", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Flatten", "[", "\[Sigma]mat", "]"}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "This", " ", "is", " ", "how", " ", "our", " ", "unknown", " ", 
          "column", " ", "vector", " ", "will", " ", "be", " ", "ordered"}], 
         ",", " ", 
         RowBox[{"so", " ", 
          RowBox[{"we", "'"}], "ll", " ", "save", " ", "it", " ", "at", " ", 
          "the", " ", 
          RowBox[{"end", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"coefficients", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"#", ",", 
              RowBox[{"Coefficient", "[", 
               RowBox[{
                RowBox[{"trans", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", "#", ",", "1"}], 
               "]"}]}], "}"}], "&"}], "/@", "unknowns"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "@", "trans"}]}], "}"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "We", " ", "extract", " ", "the", " ", "coeffecients", " ", "in", 
          " ", "terms", " ", "of", " ", "r", " ", "for", " ", "each", " ", 
          "element", " ", "of", " ", "\[Sigma]"}], ",", " ", 
         RowBox[{"each", " ", 
          RowBox[{"unknown", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"unknowns", ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"coefficients", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "j", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "@", "trans"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "@", "unknowns"}]}], "}"}]}], "]"}]}], 
        "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "We", " ", "can", " ", "set", " ", "the", " ", "coupling", " ", "elements",
     " ", "to", " ", "0."}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"uncoupledMeasurementMatrix", "=", 
    RowBox[{"generalMeasurementMatrix", "/.", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"1", ",", "3"}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"1", ",", "4"}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"2", ",", "3"}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"2", ",", "4"}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"3", ",", "1"}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"3", ",", "2"}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"4", ",", "2"}], "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"4", ",", "1"}], "]"}], "\[Rule]", "0"}]}], "}"}]}]}], ";"}],
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Using", " ", "the", " ", "notation", " ", 
      RowBox[{
       RowBox[{"r", "[", "scanIndex", "]"}], "[", 
       RowBox[{
        RowBox[{"plane", " ", "index"}], ",", 
        RowBox[{"\[Sigma]", " ", "index"}]}], "]"}], " ", "we", " ", "can", 
      " ", "give", " ", "the", " ", "full", " ", "uncoupled", " ", 
      "measurement", " ", "matrix", " ", "in", " ", "general", " ", 
      RowBox[{"form", ".", "\[IndentingNewLine]", "From"}], " ", "here", " ", 
      "solving", " ", "the", " ", "problem", " ", "is", " ", "just", " ", "a",
       " ", "matter", " ", "of", " ", "taking", " ", 
      RowBox[{"LeastSquares", "[", 
       RowBox[{
        RowBox[{"fullUncoupledMeasurementMatrix", "/.", "tranferMatrices"}], 
        ",", "measuredValues"}], "]"}], "\[IndentingNewLine]", "Where", " ", 
      "the", " ", "answer", " ", "will", " ", "be", " ", "returned", " ", 
      "as", " ", "orderedSigmaElements"}], " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"...", "10", " ", "numbers"}], "..."}], "}"}], " ", "and", 
       " ", "transferMatrices", " ", "is", " ", "a", " ", "table", " ", "of", 
       " ", 
       RowBox[{
        RowBox[{"r", "[", "s", "]"}], "[", 
        RowBox[{"i", ",", "j"}], "]"}]}], "\[Rule]", 
      RowBox[{
      "number", " ", "rules", " ", "used", " ", "to", " ", "replace", " ", 
       "the", " ", "general", " ", "values"}]}]}], ",", " ", 
    RowBox[{
    "and", " ", "measuredValues", " ", "is", " ", "a", " ", "list", " ", "of",
      " ", "3", "*", "N", " ", "measurements", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"x", "[", "1", "]"}], ",", 
       RowBox[{"y", "[", "1", "]"}], ",", 
       RowBox[{"xy", "[", "1", "]"}], ",", "...", ",", 
       RowBox[{"x", "[", "s", "]"}], ",", 
       RowBox[{"y", "[", "s", "]"}], ",", 
       RowBox[{"xy", "[", "s", "]"}], ",", 
       RowBox[{"...", 
        RowBox[{"x", "[", "N", "]"}]}], ",", 
       RowBox[{"y", "[", "N", "]"}], ",", 
       RowBox[{"xy", "[", "N", "]"}]}], "}"}], " ", "where", " ", "s", " ", 
     "is", " ", "the", " ", "scan", " ", "index", " ", "up", " ", "to", " ", 
     RowBox[{"N", ".", " ", "This"}], " ", "list", " ", "must", " ", "be", 
     " ", "ordered", " ", "this", " ", "way", " ", "as", " ", "this", " ", 
     "is", " ", "how", " ", "the", " ", "measurement", " ", "array", " ", 
     "was", " ", 
     RowBox[{"constructed", "."}]}]}], " ", "\[IndentingNewLine]", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"fullUncoupledMeasurementMatrix", "=", 
   RowBox[{"Join", "@@", 
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"uncoupledMeasurementMatrix", "/.", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"i", ",", "j"}], "]"}], "\[Rule]", 
           RowBox[{
            RowBox[{"r", "[", "scanIndex", "]"}], "[", 
            RowBox[{"i", ",", "j"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "4"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "4"}], "}"}]}], "]"}], "]"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"scanIndex", ",", "1", ",", "4"}], "}"}]}], 
     "\[IndentingNewLine]", "]"}]}]}], ";"}], "\[IndentingNewLine]"}], "Input",\

 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQA2IQnbKsrn32rdeOH6IsekG0kZDMZBBtdzFgBog+4/x7
JYieJXJyLYhe53V8O4h2k+Y7BqLvBhaeBtFXpC0fgujvexLfgehJeqmfQLSN
71yOOUD6RdRlQRD9xH+aOIjec/KzNIhu03uqCKLF7pWpgeiwPdw6IHqCRxCY
tnhSbQiifz7bZgNWv3ebI4j+xHomG0R7e30sBNGvKr6WgGiV6xU75gLpb/9a
DoJond0ZJ0C0ykX5hyB656zuzyB6grgW2zwgbda7RxNEX6tW0AXR6wLDjED0
neWrwLRn6QprEG0XtANMyxSoVYNoxVP8rSDaJMpgCohmqGs+D6KvHNvuPx9I
H1gYEgSiARHuzBc=
  "],ExpressionUUID->"da36ee56-64dc-4be1-b929-145ef4d8ed40"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Generic Equation", "Chapter",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQB2IQnbKsrn32rdeOH6IsekG0kZDMZBBtdzFgBog+4/x7
JYieJXJyLYhe53V8O4h2k+Y7BqLvBhaeBtFXpC0fgujvexLfgehJeqmfQLSN
71yOOUD6RdRlQRD9xH+aOIjec/KzNIhu03uqCKLF7pWpgeiwPdw6IHqCRxCY
tnhSbQiifz7bZgNWv3ebI4j+xHomG0R7e30sBNGvKr6WgGiV6xU75gLpb/9a
DoJond0ZJ0C0ykX5hyB656zuzyB6grgW2zwgbda7RxNEX6tW0AXR6wLDjED0
neWrwLRn6QprEG0XtANMyxSoVYNoxVP8rSDaJMpgCohmqGs+D6KvHNvuPx9I
H1gYEgSi/+1yjQHRz86bJ4NoACxN1go=
  
  "],ExpressionUUID->"41d8687c-f9e0-4940-ac35-87838228ca03"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Row", "[", "\[IndentingNewLine]", 
  RowBox[{"{", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MatrixForm", "[", 
     RowBox[{"List", "/@", 
      RowBox[{"Join", "@@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
           "\"\<\!\(\*SubscriptBox[\(\[Sigma]\), \(xx\)]\)\>\"", "[", "i", 
            "]"}], ",", 
           RowBox[{
           "\"\<\!\(\*SubscriptBox[\(\[Sigma]\), \(yy\)]\)\>\"", "[", "i", 
            "]"}], ",", 
           RowBox[{
           "\"\<\!\(\*SubscriptBox[\(\[Sigma]\), \(xy\)]\)\>\"", "[", "i", 
            "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "4"}], "}"}]}], "]"}]}]}], "]"}], " ", 
    ",", "\[IndentingNewLine]", "\"\< = \>\"", ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"MatrixForm", "@", "fullUncoupledMeasurementMatrix"}], ")"}], 
     ".", 
     RowBox[{"MatrixForm", "[", 
      RowBox[{"List", "/@", "orderedSigmaElements"}], "]"}]}]}], 
   "\[IndentingNewLine]", "}"}], "\[IndentingNewLine]", "]"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQAGIQnbKsrn32rdeOH6IsekG0kZDMZBBtdzFgBog+4/x7
JYieJXJyLYhe53V8O4h2k+Y7BqLvBhaeBtFXpC0fgujvexLfgehJeqmfQLSN
71yOOUD6RdRlQRD9xH+aOIjec/KzNIhu03uqCKLF7pWpgeiwPdw6IHqCRxCY
tnhSbQiifz7bZgNWv3ebI4j+xHomG0R7e30sBNGvKr6WgGiV6xU75gLpb/9a
DoJond0ZJ0C0ykX5hyB656zuzyB6grgW2zwgbda7RxNEX6tW0AXR6wLDjED0
neWrwLRn6QprEG0XtANMyxSoVYNoxVP8rSDaJMpgCohmqGs+D6KvHNvuPx9I
H1gYEgSi/+1yjQHR7358TgfRc358rwbRBy01akA0AP6J4Oo=
  
  "],ExpressionUUID->"c8b86317-d3ad-4cef-9205-d077a0dbc727"],

Cell[BoxData[
 TemplateBox[{TagBox[
    RowBox[{"(", "\[NoBreak]", 
      GridBox[{{
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(xx\\)]\\)\"", "[", "1", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(yy\\)]\\)\"", "[", "1", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(xy\\)]\\)\"", "[", "1", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(xx\\)]\\)\"", "[", "2", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(yy\\)]\\)\"", "[", "2", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(xy\\)]\\)\"", "[", "2", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(xx\\)]\\)\"", "[", "3", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(yy\\)]\\)\"", "[", "3", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(xy\\)]\\)\"", "[", "3", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(xx\\)]\\)\"", "[", "4", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(yy\\)]\\)\"", "[", "4", 
           "]"}]}, {
         RowBox[{
          "\"\\!\\(\\*SubscriptBox[\\(\[Sigma]\\), \\(xy\\)]\\)\"", "[", "4", 
           "]"}]}}, RowSpacings -> 1, ColumnSpacings -> 1, RowAlignments -> 
       Baseline, ColumnAlignments -> Center], "\[NoBreak]", ")"}], 
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]],"\" = \"",RowBox[{
     TagBox[
      RowBox[{"(", "\[NoBreak]", 
        GridBox[{{
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "1", "]"}], "[", 
              RowBox[{"1", ",", "1"}], "]"}], "2"], 
           RowBox[{"2", " ", 
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}]}], "0", "0", 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "1", "]"}], "[", 
              RowBox[{"1", ",", "2"}], "]"}], "2"], "0", "0", "0", "0", 
           "0"}, {"0", "0", "0", "0", "0", "0", "0", 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "1", "]"}], "[", 
              RowBox[{"3", ",", "3"}], "]"}], "2"], 
           RowBox[{"2", " ", 
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "1", "]"}], "[", 
              RowBox[{"3", ",", "4"}], "]"}], "2"]}, {"0", "0", 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}]}], 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], "0", 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}]}], 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "1", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], "0", "0", "0"}, {
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "2", "]"}], "[", 
              RowBox[{"1", ",", "1"}], "]"}], "2"], 
           RowBox[{"2", " ", 
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}]}], "0", "0", 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "2", "]"}], "[", 
              RowBox[{"1", ",", "2"}], "]"}], "2"], "0", "0", "0", "0", 
           "0"}, {"0", "0", "0", "0", "0", "0", "0", 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "2", "]"}], "[", 
              RowBox[{"3", ",", "3"}], "]"}], "2"], 
           RowBox[{"2", " ", 
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "2", "]"}], "[", 
              RowBox[{"3", ",", "4"}], "]"}], "2"]}, {"0", "0", 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}]}], 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], "0", 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}]}], 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "2", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], "0", "0", "0"}, {
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "3", "]"}], "[", 
              RowBox[{"1", ",", "1"}], "]"}], "2"], 
           RowBox[{"2", " ", 
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}]}], "0", "0", 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "3", "]"}], "[", 
              RowBox[{"1", ",", "2"}], "]"}], "2"], "0", "0", "0", "0", 
           "0"}, {"0", "0", "0", "0", "0", "0", "0", 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "3", "]"}], "[", 
              RowBox[{"3", ",", "3"}], "]"}], "2"], 
           RowBox[{"2", " ", 
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "3", "]"}], "[", 
              RowBox[{"3", ",", "4"}], "]"}], "2"]}, {"0", "0", 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}]}], 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], "0", 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}]}], 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "3", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], "0", "0", "0"}, {
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "4", "]"}], "[", 
              RowBox[{"1", ",", "1"}], "]"}], "2"], 
           RowBox[{"2", " ", 
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}]}], "0", "0", 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "4", "]"}], "[", 
              RowBox[{"1", ",", "2"}], "]"}], "2"], "0", "0", "0", "0", 
           "0"}, {"0", "0", "0", "0", "0", "0", "0", 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "4", "]"}], "[", 
              RowBox[{"3", ",", "3"}], "]"}], "2"], 
           RowBox[{"2", " ", 
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], 
           SuperscriptBox[
            RowBox[{
              RowBox[{"r", "[", "4", "]"}], "[", 
              RowBox[{"3", ",", "4"}], "]"}], "2"]}, {"0", "0", 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}]}], 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"1", ",", "1"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], "0", 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"3", ",", "3"}], "]"}]}], 
           RowBox[{
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{
               RowBox[{"r", "[", "4", "]"}], "[", 
               RowBox[{"3", ",", "4"}], "]"}]}], "0", "0", "0"}}, RowSpacings -> 
         1, ColumnSpacings -> 1, RowAlignments -> Baseline, ColumnAlignments -> 
         Center], "\[NoBreak]", ")"}], 
      Function[BoxForm`e$, 
       MatrixForm[BoxForm`e$]]], ".", 
     TagBox[
      RowBox[{"(", "\[NoBreak]", 
        GridBox[{{
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"1", ",", "1"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"1", ",", "2"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"1", ",", "3"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"1", ",", "4"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"2", ",", "2"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"2", ",", "3"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"2", ",", "4"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"3", ",", "3"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"3", ",", "4"}], "]"}]}, {
           RowBox[{"\[Sigma]", "[", 
             RowBox[{"4", ",", "4"}], "]"}]}}, RowSpacings -> 1, 
         ColumnSpacings -> 1, RowAlignments -> Baseline, ColumnAlignments -> 
         Center], "\[NoBreak]", ")"}], 
      Function[BoxForm`e$, 
       MatrixForm[BoxForm`e$]]]}]},
  "RowDefault"]], "Output",
 CellChangeTimes->{{3.738499822836265*^9, 3.738499841254957*^9}, {
   3.738499895551188*^9, 3.738499904325049*^9}, 
   3.7385003046705*^9},ExpressionUUID->"57a0e9b0-ba0a-4cec-b25f-1940e56db093"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.738499651843642*^9, 3.7384997065099897`*^9}, {
  3.738499937025332*^9, 3.738499957208921*^9}, {3.7385065749127827`*^9, 
  3.738506729605423*^9}},ExpressionUUID->"a8844a57-650f-4397-96a1-\
180101a84f1f"],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {"100", 
      RowBox[{"20", " ", 
       RowBox[{
        RowBox[{"r", "[", "1", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}]}], "0", "0", 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "1", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], "2"], "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", "16", 
      RowBox[{"8", " ", 
       RowBox[{
        RowBox[{"r", "[", "1", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "1", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}], "2"]},
     {"0", "0", "40", 
      RowBox[{"10", " ", 
       RowBox[{
        RowBox[{"r", "[", "1", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], "0", 
      RowBox[{"4", " ", 
       RowBox[{
        RowBox[{"r", "[", "1", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "1", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "1", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], "0", "0", "0"},
     {
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], "2"], 
      RowBox[{"2", " ", 
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}]}], "0", "0", 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], "2"], "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}], "2"], 
      RowBox[{"2", " ", 
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}], "2"]},
     {"0", "0", 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], "0", 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "2", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], "0", "0", "0"},
     {
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], "2"], 
      RowBox[{"2", " ", 
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}]}], "0", "0", 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], "2"], "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}], "2"], 
      RowBox[{"2", " ", 
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}], "2"]},
     {"0", "0", 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], "0", 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "3", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], "0", "0", "0"},
     {
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], "2"], 
      RowBox[{"2", " ", 
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}]}], "0", "0", 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], "2"], "0", "0", "0", "0", "0"},
     {"0", "0", "0", "0", "0", "0", "0", 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}], "2"], 
      RowBox[{"2", " ", 
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], 
      SuperscriptBox[
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}], "2"]},
     {"0", "0", 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"1", ",", "1"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], "0", 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"3", ",", "3"}], "]"}]}], 
      RowBox[{
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"1", ",", "2"}], "]"}], " ", 
       RowBox[{
        RowBox[{"r", "[", "4", "]"}], "[", 
        RowBox[{"3", ",", "4"}], "]"}]}], "0", "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[0.7]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.4]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{{3.738499691393079*^9, 3.738499704163638*^9}, {
  3.738499940678542*^9, 3.7384999431198797`*^9}, {3.738506579726383*^9, 
  3.738506607617955*^9}, {3.738506653541197*^9, 
  3.738506661666751*^9}},ExpressionUUID->"88fb451b-d344-4147-84f7-\
c73f4a6d4c82"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"LeastSquares", "[", 
  RowBox[{
   RowBox[{"fullUncoupledMeasurementMatrix", "/.", "transferDefs"}], ",", 
   "measurements"}], "]"}]], "Input",
 CellChangeTimes->{{3.738506810485515*^9, 
  3.738506826737458*^9}},ExpressionUUID->"ca8de37a-1eed-4ba2-8151-\
ec6dca9bf7be"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"twiss", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"getTwissAtElement", "[", 
        RowBox[{"\"\<QTV_C11\>\"", ",", 
         RowBox[{"Last", "@", 
          RowBox[{"madFileToDataset", "[", "#", "]"}]}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"getTwissAtElement", "[", 
        RowBox[{"\"\<MARK\>\"", ",", 
         RowBox[{"Last", "@", 
          RowBox[{"madFileToDataset", "[", "#", "]"}]}]}], "]"}]}], 
      "\[IndentingNewLine]", "}"}], "&"}], "/@", "files"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rmats", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"R", "[", 
      RowBox[{"#1", ",", "#2"}], "]"}], "&"}], "@@@", "twiss"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Join", "@@", 
  RowBox[{"Map", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ReplaceAll", "[", 
      RowBox[{"generalMeasurementMatrix", ",", 
       RowBox[{"createRules", "[", "#", "]"}]}], "]"}], "&"}], ",", 
    "\[IndentingNewLine]", "rmats"}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.738592925594214*^9, 3.7385929269334803`*^9}, 
   3.7386776668251667`*^9},ExpressionUUID->"bf5246b5-2cc3-4ac2-94ad-\
f051b140ecf3"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1008, 789},
WindowMargins->{{Automatic, 34}, {Automatic, 0}},
FrontEndVersion->"11.2 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
10, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 221, 4, 98, "Title",ExpressionUUID->"8a0ca74d-3ee4-45cb-b80d-ab13dc7b6af9"],
Cell[CellGroupData[{
Cell[826, 30, 568, 10, 165, "Chapter",ExpressionUUID->"65fc3e1f-07b4-4f10-885c-0d4867cd770d"],
Cell[1397, 42, 1600, 39, 153, "Text",ExpressionUUID->"9ff1ce17-d240-4489-9e41-e8bd16969459"],
Cell[3000, 83, 9889, 243, 829, "Input",ExpressionUUID->"da36ee56-64dc-4be1-b929-145ef4d8ed40"]
}, Open  ]],
Cell[CellGroupData[{
Cell[12926, 331, 535, 10, 69, "Chapter",ExpressionUUID->"41d8687c-f9e0-4940-ac35-87838228ca03"],
Cell[CellGroupData[{
Cell[13486, 345, 1644, 39, 167, "Input",ExpressionUUID->"c8b86317-d3ad-4cef-9205-d077a0dbc727"],
Cell[15133, 386, 12731, 316, 247, "Output",ExpressionUUID->"57a0e9b0-ba0a-4cec-b25f-1940e56db093"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27901, 707, 305, 5, 73, "Input",ExpressionUUID->"a8844a57-650f-4397-96a1-180101a84f1f"],
Cell[28209, 714, 7962, 237, 258, "Output",ExpressionUUID->"88fb451b-d344-4147-84f7-c73f4a6d4c82"]
}, Open  ]],
Cell[36186, 954, 294, 7, 30, "Input",ExpressionUUID->"ca8de37a-1eed-4ba2-8151-ec6dca9bf7be"],
Cell[36483, 963, 1265, 35, 178, "Input",ExpressionUUID->"bf5246b5-2cc3-4ac2-94ad-f051b140ecf3"]
}, Open  ]]
}, Open  ]]
}
]
*)

